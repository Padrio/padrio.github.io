---
interface Props {
  company: string;
  role: string;
  period: string;
  shortDescription: string;
  description: string;
  skills?: string[];
  logo?: string;
  isCurrent?: boolean;
}

const { company, role, period, shortDescription, description, skills = [], logo, isCurrent = false } = Astro.props;
const cardId = `exp-${company.replace(/\s+/g, '-').toLowerCase()}`;
---

<div class="glass-card p-4 md:p-6 transition-all duration-300 hover:-translate-y-0.5">
  <div class="flex items-start gap-4">
    {logo && (
      <div class="flex-shrink-0">
        <img 
          src={logo} 
          alt={`${company} logo`}
          class="w-12 h-12 rounded-xl object-cover bg-stone-100"
          onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
        />
        <div class="w-12 h-12 rounded-xl bg-stone-100 flex items-center justify-center text-xs font-bold text-stone-400" style="display: none;">
          {company.charAt(0)}
        </div>
      </div>
    )}
    <div class="flex-1">
      <div class="flex flex-col md:flex-row md:items-start justify-between gap-2 md:gap-4 mb-2">
        <div>
          <div class="flex items-center gap-2 mb-1">
            <h3 class="text-lg font-semibold text-stone-800">
              {role}
            </h3>
            {isCurrent && (
              <span class="badge badge-current">Current</span>
            )}
          </div>
          <p class="text-sm font-medium text-stone-700">
            {company}
          </p>
        </div>
        <span class="text-xs text-stone-500 whitespace-nowrap">
          {period}
        </span>
      </div>
      
      <!-- Short Description (always visible) -->
      <p class="text-sm text-stone-600 leading-relaxed" id={`${cardId}-short`}>
        {shortDescription}
      </p>
      
      <!-- Full Description (hidden by default) -->
      <div class="hidden mt-2" id={`${cardId}-full`}>
        <p class="text-sm text-stone-600 leading-relaxed">
          {description}
        </p>
      </div>
      
      <!-- Read More Toggle -->
      <button 
        type="button"
        class="text-xs text-orange-600 hover:text-orange-700 mt-2 flex items-center gap-1 transition-colors"
        data-toggle={cardId}
        aria-expanded="false"
      >
        <span class="toggle-text">Read more</span>
        <svg class="w-3 h-3 transition-transform toggle-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </button>
      
      <!-- Skills Tags -->
      {skills.length > 0 && (
        <div class="flex flex-wrap gap-2 mt-3">
          {skills.map((skill) => (
            <span class="px-2 py-0.5 text-xs bg-stone-100 text-stone-600 rounded-md">
              {skill}
            </span>
          ))}
        </div>
      )}
    </div>
  </div>
</div>

<script>
  document.querySelectorAll('[data-toggle]').forEach(button => {
    button.addEventListener('click', () => {
      const cardId = button.getAttribute('data-toggle');
      const shortDesc = document.getElementById(`${cardId}-short`);
      const fullDesc = document.getElementById(`${cardId}-full`);
      const toggleText = button.querySelector('.toggle-text');
      const toggleIcon = button.querySelector('.toggle-icon');
      const isExpanded = button.getAttribute('aria-expanded') === 'true';
      
      if (isExpanded) {
        shortDesc?.classList.remove('hidden');
        fullDesc?.classList.add('hidden');
        if (toggleText) toggleText.textContent = 'Read more';
        toggleIcon?.classList.remove('rotate-180');
        button.setAttribute('aria-expanded', 'false');
      } else {
        shortDesc?.classList.add('hidden');
        fullDesc?.classList.remove('hidden');
        if (toggleText) toggleText.textContent = 'Read less';
        toggleIcon?.classList.add('rotate-180');
        button.setAttribute('aria-expanded', 'true');
      }
    });
  });
</script>
